groups:
  - name: system_anomaly_alerts
    rules:
      - alert: HighCPUUsage
        expr: cpu_usage > 90
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is above 90% for more than 2 minutes on {{ $labels.instance }}"

      - alert: HighMemoryUsage
        expr: memory_usage > 90
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is above 90% for more than 2 minutes on {{ $labels.instance }}"

      - alert: AnomalyDetected
        expr: system_anomalies_total > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "System anomaly detected"
          description: "{{ $value }} anomalies detected in the system monitoring pipeline"

      - alert: HighErrorRate
        expr: error_rate_percent > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate is above 5% for more than 5 minutes on {{ $labels.instance }}"

      - alert: HighResponseTime
        expr: response_time_ms > 1000
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "High response time detected"
          description: "Response time is above 1000ms for more than 3 minutes on {{ $labels.instance }}"

      - alert: DiskIOBottleneck
        expr: disk_io_mbps > 500
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Disk I/O bottleneck detected"
          description: "Disk I/O is above 500 MB/s for more than 2 minutes on {{ $labels.instance }}"

      - alert: NetworkCongestion
        expr: network_io_mbps > 200
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Network congestion detected"
          description: "Network I/O is above 200 MB/s for more than 2 minutes on {{ $labels.instance }}"

  - name: spark_application_alerts
    rules:
      - alert: SparkJobFailed
        expr: spark_job_status == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Spark job failed"
          description: "Spark anomaly detection job has failed on {{ $labels.instance }}"

      - alert: SparkJobLongRunning
        expr: spark_job_duration_seconds > 3600
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Spark job running too long"
          description: "Spark job has been running for more than 1 hour on {{ $labels.instance }}"

